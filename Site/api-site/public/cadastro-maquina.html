<!DOCTYPE html>
<html lang="pt">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet" rel='stylesheet'>
	<!-- My CSS -->
	<link rel="stylesheet" href="./css/cadastros-logado.css">
	<link rel="stylesheet" href="https://fonts.sandbox.google.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0"/>
	<script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
	<link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="./css/modal.css">
	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<title>DataCat</title>
	
</head>

<body onload='listarMaquina("/usuarioController")'>

	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<img src="./assets/imagens/logo/logo-black.png"
				alt="">
			<span class="text">DataCat</span>
		</a>
		<ul class="side-menu top">
			<li>
				<a href=".//dashboard/dashboard.html">
					<span class="material-icons-sharp">
						grid_view
					</span>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="./cadastro-funcionario.html">
					<span class="material-icons-sharp">
						perm_identity
					</span>
					<span class="text">Cadastrar usuário</span>
				</a>
			</li>
			<li>
				<a href="#">
					<span class="material-icons-sharp">
						notifications
					</span>
					<span class="text">Notifições</span>
				</a>
			</li>
			<li class="active">
				<a href="./cadastro-maquina.html">
					<span class="material-icons-sharp">add_to_queue</span>
					<span>Cadastrar máquina</span>
				</a>
			</li>
			<li>
				<a href="#">
					<span class="material-icons-sharp">
						groups
					</span>
					<span class="text">Team</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<span class="material-icons-sharp">settings</span>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="login.html" onclick="limparSessao()" class="logout">
					<span class="material-icons-sharp">logout</span>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu'></i>
			<!-- <span class="material-icons-sharp"> -->


			<a href="#" class="nav-link">Categorias</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>

				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<span class="material-icons-sharp">
					notifications
				</span>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="./assets/fotos/leticia.jfif">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Cadastro Máquina / Servidor</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Cadastro Máquina / Servidor</a>
						</li>
					</ul>
				</div>
				<a href="#" onclick="sair()" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>


			<div>
				<div class="box-subscribe-machine">
					<div class="subscribe-left">
						<div class="title-subscribe">
							<h3>Faça o cadastro das suas máquinas e servidores e receba seus dados dinâmicamente onde estiver</h3>
							<i>Cadastre agora</i>
						</div>
						<img src="./assets/imagens/atm_single_png.png" alt="">
					</div>
					<div class = "subscribe-right">
						<form action="" id="form_cadastroMaquina" method="post" onsubmit="return cadastrarMaquina()">
							<label for="">Identificador Máquina</label>
							<input name="hostName" id="hostName" type="text" required maxlength="15">
							<label for="">Grupo</label>
							<input name="grupo" id="grupo" type="text" required maxlength="15">
							<label for="">Componente</label>
							<select name="nome" id="nome"  required maxlength="3">
								<option value="Ram">RAM</option>
								<option value="Cpu">CPU</option>
								<option value="Disco">DISCO</option>
							</select>
							<label for="">Capacidade</label>
							<input name="capacidade" id="capacidade" type="number" required maxlength="45">
							<label for="">Limite Alerta</label>
							<select name="limiteAlerta" id="limiteAlerta" type="" required maxlength="15">
								<option value="50">50%</option>
								<option value="60">60%</option>
								<option value="70">70%</option>
								<option value="80">80%</option>
								<option value="90">90%</option>
								<option value="100">100%</option>
							</select>
							<div class="space-btn">
								<button class="btn"><h3><a>Cadastrar</a></h3></button>
							</div>
						</form>
					</div>
				</div>
			</div>
			
			<button class="btn-modal" id="myBtn">Editar</button>
			<button class="btn-modal" id="myBtn2">Deletar</button>

			<div class="box-info-funcionario">
				<h1 class="identificacao">Identificação</h1>
				<h1>Componente</h1>
				<h1>Capacidade</h1>
				<h1>Alerta</h1>
				
			</div>
			<div id="listaMaquina"></div>
			<!-- The Modal -->
<div id="myModal" class="modal">

	<!-- Modal content -->
	<div class="modal-content">
	  <span class="close">&times;</span>
	  <p>
		  <div>
			  <div class="box-subscribe">
				  <div class="subscribe-left">
					  <div class="title-subscribe">
						  <h3>Altere os dados do seu time e deixe todos infomados</h3>
					  </div>
					  <img src="./assets/imagens/filing-system-amico.png" alt="">
				  </div>
				  
				  <div id="cadastro" class = "subscribe-right">
					  <form action="" id="form_upDateUsuario" method="post" onsubmit="return upDateMaquina()">
						  <label  for="">Coloque o Id da maquina que deseja editar</label>
						  <input name="idMaquinaComponentes" type="text"  maxlength="15">
						  <label for="">Componente</label>
							<select name="nome" id="nome"  required maxlength="3">
								<option value="Ram">RAM</option>
								<option value="Cpu">CPU</option>
								<option value="Disco">DISCO</option>
							</select>
						  <label for="">Capacidade</label>
						  <input name="capacidade" id="capacidade" type="text" maxlength="15">
						  <label for="">Limite Alerta</label>
						  <select name="limiteAlerta" id="limiteAlerta" type="" required maxlength="15">
							  <option value="50">50%</option>
							  <option value="60">60%</option>
							  <option value="70">70%</option>
							  <option value="80">80%</option>
							  <option value="90">90%</option>
							  <option value="100">100%</option>
						  </select>
						  <div class="space-btn">
						  <button class="btn"><h3><a>Editar</a></h3></button>
						  </div>
					  </form>
					  
				  
				  </div>
			  </div>
		  </div>	
	  </p>
	</div>
  
  </div>
  
  <!-- The Modal -->
  <div id="myModal2" class="modal">
  
	<!-- Modal content -->
	<div class="modal-content">
	  <span class="close">&times;</span>
	  <p>
		  <div>
			  <div class="box-subscribe">
				  <div class="subscribe-left">
					  <div class="title-subscribe">
						  <h3>Delete um usuario do seu time </h3>
					  </div>
					  <img src="./assets/imagens/filing-system-amico.png" alt="">
				  </div>
				  
				  <div id="cadastro" class = "subscribe-right">
					  <form action="" id="form_deletarMaquina" method="post" onsubmit="return deletarMaquina()">
						  <label  for="">Identificador</label>
						  <input name="idMaquinaComponentes" type="text"  maxlength="15">
						  <label for="">Componente</label>
						  <input name="nome" type="text"  maxlength="45">
						  <div class="space-btn">
						  <button class="btn"><h3><a>Deletar usuario</a></h3></button>
						  </div>
					  </form>
					  
				  
				  </div>
			  </div>
		  </div>	
	  </p>
	</div>
  
  </div>
			<!-- <ul class="box-info">
				<li>
					
					<span class="text">
						<div class="div-title">
							<div class="icon">
						<span class="material-icons-sharp">	memory</span>
					       </div>
						<h3>Memória ram</h3>
					   </div>
					<div class="memoria">
					<canvas id="graficoMemoria"></canvas>
					<div>
			        
					</span>
				</li>
				</ul> -->
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->


	<!-- <script src="script.js"></script> -->

</body>

</html>
<script>
// Get the modal
var modal = document.getElementById("myModal");
var modal2 = document.getElementById("myModal2");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");
var btn2 = document.getElementById("myBtn2");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];



// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}
btn2.onclick = function() {
  modal2.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
  modal2.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal || event.target == modal2 ) {
    modal.style.display = "none";
	modal2.style.display = "none";
  }
}



	const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');

	allSideMenu.forEach(item => {
		const li = item.parentElement;

		item.addEventListener('click', function () {
			allSideMenu.forEach(i => {
				i.parentElement.classList.remove('active');
			})
			li.classList.add('active');
		})
	});




	// TOGGLE SIDEBAR
	const menuBar = document.querySelector('#content nav .bx.bx-menu');
	const sidebar = document.getElementById('sidebar');

	menuBar.addEventListener('click', function () {
		sidebar.classList.toggle('hide');
	})







	const searchButton = document.querySelector('#content nav form .form-input button');
	const searchButtonIcon = document.querySelector('#content nav form .form-input button .bx');
	const searchForm = document.querySelector('#content nav form');

	searchButton.addEventListener('click', function (e) {
		if (window.innerWidth < 576) {
			e.preventDefault();
			searchForm.classList.toggle('show');
			if (searchForm.classList.contains('show')) {
				searchButtonIcon.classList.replace('bx-search', 'bx-x');
			} else {
				searchButtonIcon.classList.replace('bx-x', 'bx-search');
			}
		}
	})





	if (window.innerWidth < 768) {
		sidebar.classList.add('hide');
	} else if (window.innerWidth > 576) {
		searchButtonIcon.classList.replace('bx-x', 'bx-search');
		searchForm.classList.remove('show');
	}


	window.addEventListener('resize', function () {
		if (this.innerWidth > 576) {
			searchButtonIcon.classList.replace('bx-x', 'bx-search');
			searchForm.classList.remove('show');
		}
	})



	const switchMode = document.getElementById('switch-mode');

	switchMode.addEventListener('change', function () {
		if (this.checked) {
			document.body.classList.add('dark');

		} else {
			document.body.classList.remove('dark');
		}
	})

	function plotarGrafico(idGrafico) {

		const ctx = document.getElementById(idGrafico).getContext('2d');
		let myChart = new Chart(ctx, {
			type: 'line',

			data: {
				labels: gerarDatas(),
				datasets: [{
					label: 'Desempenho',
					data: gerarDados(),
					backgroundColor: [
						'rgba(255, 99, 132, 0.12)',
					],
					borderColor: [
						'rgba(255, 99, 132, 1)',
					],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});
	}

	function gerarDados() {
		dados = [];
		for (let index = 0; index < 30; index++) {
			dados.push((Math.random() * 100).toFixed(0));
		}
		return dados;
	}
	function gerarDatas() {
		datas = [];
		for (let index = 0; index < 30; index++) {
			datas.push((Math.random() * 23).toFixed(0) + ':' + (Math.random() * 59).toFixed(0) + ':' + (Math.random() * 59).toFixed(0));
		}
		return datas.sort();
	}

	function cadastrarMaquina() {

var formulario = new URLSearchParams(new FormData(document.getElementById("form_cadastroMaquina")));

var hostName = formulario.get("hostName");
var grupo = formulario.get("grupo");
var nome = formulario.get("nome");
var capacidade = formulario.get("capacidade");
var limiteAlerta = formulario.get("limiteAlerta");



// TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
if (hostName == "" || grupo == "" || nome == "" || capacidade == "" || limiteAlerta == "" ) {

window.alert("Preencha todos os campos para prosseguir!");
    if (hostName == "" ) {
		console.log("hostName está em branco!");
	}
	if (grupo == "") {
		console.log('grupo está em branco')
	}
	if (nome == "") {
		console.log("nome está em branco!");
	}
	if (capacidade == "") {
		console.log('capacidade está em branco')
	}
	if (limiteAlerta == "" || grupo == "" ) {
		console.log("limiteAlerta está em branco!");
	}
	
		return false;
	}

fetch("/usuarios/cadastrarMaquina", {
method: "POST",
body: formulario,
}).then(function (resposta) {

console.log("resposta: ", resposta);

if (resposta.ok) {
	window.alert("Cadastro realizado com sucesso!");
} else {
	throw ("Houve um erro ao tentar realizar o cadastro!");
}
}).catch(function (resposta) {
console.log(`#ERRO: ${resposta}`);
});
return false;
}

function listarMaquina(){
fetch(`/usuarios/listarMaquina`, {
    method: "GET",
}).then(function (resposta) {

    // console.log("resposta: ", resposta);
    resposta.json().then((json) => {
        var obj = (json);
        console.log(obj)
		for(var i = 0; i < 20; i++) {
			    listaMaquina.innerHTML += `
			<div class="box-informacoes-cadastradas">
			
			<div class="titulos">
		    <h4 class="title-ram">${obj[i].idMaquinaComponentes}</h4>
			<h4 class="title-alerta">${obj[i].nome}</h4>
			<h4 class="title-alerta">${obj[i].capacidade}</h4>
			<h4 class="title-alerta">${obj[i].limiteAlerta}%</h4>
			<div class="wrapper">
				<div class="icon editar">
					<div  class="tooltip">Editar</div>
					<span id="editar-div" class="icons">
					<i id="editar" class="material-symbols-sharp">border_color</i>
				</span>
				</div>
			</div>
			<div class="wrapper">
				<div class="icon excluir">
					<div  id="tooltip-excluir" class="tooltip">Excluir</div>
					<span id="deletar-div" class="icons">
					<i id="deletar" class="material-symbols-sharp">delete</i>
				    </span>
			    </div>
			</div>
		  </div>
		</div>

                    `
                }
    }).catch((erro) => {

    })

}).catch(function (resposta) {
    if (resposta.status == 406) {
        alert('Oops!! Parece que você ja curtiu esse livro... que tal procurar um outro que tenha interesse? :)')
    }
    console.log(`#ERRO:${resposta}`);

});
}


function deletarMaquina() {


var formulario = new URLSearchParams(new FormData(document.getElementById("form_deletarMaquina")));

var idMaquinaComponentes = formulario.get("idMaquinaComponentes");
var nome= formulario.get("nome");


// TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
if (idMaquinaComponentes == "" || nome == "") {
	window.alert("Preencha todos os campos para prosseguir!");

	return false;
}



fetch("/usuarios/deletarMaquina", {
	method: "POST",
	body: formulario
}).then(function (resposta) {
	console.log("ESTOU NO THEN DO deletarMaquina()!")

	if (resposta.ok) {
		console.log(resposta);

		resposta.json().then(json => {
			console.log(json);
			console.log(JSON.stringify(json));

			sessionStorage.EMAIL_USUARIO = json.email;
			sessionStorage.NOME_USUARIO = json.Nome;
			sessionStorage.ID_USUARIO = json.idUsuario;
			window.alert("Delete realizado com sucesso!");

		});

	} else {

		console.log("Houve um erro ao tentar deletar usuário!");

		resposta.text().then(texto => {
			console.error(texto);
		});
	}

}).catch(function (erro) {
	console.log(erro);
})

return false;
}

function upDateMaquina() {


var formulario = new URLSearchParams(new FormData(document.getElementById("form_upDateUsuario")));

var idMaquinaComponentes = formulario.get("idMaquinaComponentes");
var nome = formulario.get("nome");
var capacidade = formulario.get("capacidade");
var limiteAlerta = formulario.get("limiteAlerta");



// TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
if (hostName == "" || grupo == "" || nome == "" || capacidade == "" || limiteAlerta == "" ) {

window.alert("Preencha todos os campos para prosseguir!");
    if (hostName == "" ) {
		console.log("hostName está em branco!");
	}
	if (nome == "") {
		console.log("nome está em branco!");
	}
	if (capacidade == "") {
		console.log('capacidade está em branco')
	}
	if (limiteAlerta == "" || grupo == "" ) {
		console.log("limiteAlerta está em branco!");
	}
	
		return false;
	}

fetch("/usuarios/upDateMaquina", {
	method: "POST",
	body: formulario
}).then(function (resposta) {

	console.log("resposta: ", resposta);

	if (resposta.ok) {
		window.alert("upDate realizado com sucesso!");
	} else {
		throw ("Houve um erro ao tentar realizar o upDate!");
	}
}).catch(function (resposta) {
	console.log(`#ERRO: ${resposta}`);
});

return false;
}


</script>
<script src="./js/funcoes.js"></script>